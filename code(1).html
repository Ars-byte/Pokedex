<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pokédex</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23FF5C5C'/%3E%3Cpath d='M 5 50 A 45 45 0 0 1 95 50 H 5 Z' fill='%23FFFFFF'/%3E%3Cline x1='5' y1='50' x2='95' y2='50' stroke='%23333333' stroke-width='8'/%3E%3Ccircle cx='50' cy='50' r='18' fill='%23FFFFFF' stroke='%23333333' stroke-width='8'/%3E%3Ccircle cx='50' cy='50' r='10' fill='%23FFFFFF'/%3E%3C/svg%3E">
  <style>
    :root {
      --matcha-bg-light: #e0eee0;
      --matcha-bg-medium: #a3b18a;
      --matcha-accent: #588157;
      --matcha-text: #3a5a40;
      --matcha-card-bg: #f0f5f0; /* Fallback card background */
      --matcha-border: #8a9a5b;
      --pokeball-red: #ff5c5c;
      --pokeball-white: #ffffff;
      --pokeball-black: #333333;

      --text-on-dark-card: #f0f5f0;
      --text-on-light-card: #2c3e50; /* Un poco más oscuro para mejor contraste en fondos coloridos claros */
      --text-types-on-dark-card: #ffffffcc;
      --text-types-on-light-card: #4a5a40;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', 'Helvetica Neue', Helvetica, sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--matcha-bg-light), var(--matcha-bg-medium));
      color: var(--matcha-text);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    h1 {
      font-size: 2.8rem; /* Un poco más grande */
      margin-bottom: 20px;
      color: var(--matcha-accent);
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.15);
      font-weight: 700;
    }

    #navigation-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding: 10px;
      background-color: rgba(255, 255, 255, 0.25);
      border-radius: 25px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .gen-btn, #refresh-btn {
      padding: 9px 16px;
      font-size: 0.95rem;
      background: var(--matcha-accent);
      color: var(--matcha-bg-light);
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
    }

    .gen-btn:hover, #refresh-btn:hover {
      background: var(--matcha-text);
      transform: translateY(-2px);
    }

    #refresh-btn svg {
      width: 22px;
      height: 22px;
    }
    
    #search-container {
      margin-bottom: 25px;
      display: flex;
      gap: 10px;
    }

    #search-input {
      padding: 10px 15px;
      font-size: 1rem;
      border: 2px solid var(--matcha-border);
      border-radius: 25px;
      background: var(--matcha-card-bg);
      color: var(--matcha-text);
      outline: none;
      width: 230px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    #search-input::placeholder {
      color: var(--matcha-border);
    }

    #search-input:focus {
      border-color: var(--matcha-accent);
      box-shadow: 0 0 8px rgba(88, 129, 87, 0.3);
    }

    #search-btn {
      padding: 10px 18px;
      font-size: 1rem;
      background: var(--matcha-accent);
      color: var(--matcha-bg-light);
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: background 0.3s ease;
      font-weight: 500;
    }

    #search-btn:hover {
      background: var(--matcha-text);
    }

    #pokemon-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); /* Tarjetas un poco más anchas */
      gap: 20px;
      max-width: 1200px;
      width: 100%;
    }

    .pokemon-card {
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.12);
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      /* Background and text color will be set by JS based on type */
      background: var(--matcha-card-bg); /* Fallback */
      color: var(--text-on-light-card); /* Default text color */
      overflow: hidden; /* Para que gradientes no se salgan si hay bordes internos */
    }
    
    .pokemon-card.dark-bg-card {
      color: var(--text-on-dark-card);
    }
    .pokemon-card.dark-bg-card h3,
    .pokemon-card.dark-bg-card .stats p {
      color: var(--text-on-dark-card);
    }
    .pokemon-card.dark-bg-card .types {
      color: var(--text-types-on-dark-card);
    }

    /* Default text colors for light cards */
    .pokemon-card:not(.dark-bg-card) h3,
    .pokemon-card:not(.dark-bg-card) .stats p {
       color: var(--text-on-light-card);
    }
    .pokemon-card:not(.dark-bg-card) .types {
       color: var(--text-types-on-light-card);
    }


    .pokemon-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.18);
    }

    .pokemon-card img {
      width: 100px; /* Más grandes */
      height: 100px;
      margin-bottom: 12px;
      image-rendering: pixelated;
      filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
    }
    
    .pokemon-card .no-sprite {
        width: 100px;
        height: 100px;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(0,0,0,0.05);
        border-radius: 50%;
        font-size: 0.8em;
        color: inherit; /* Hereda de .pokemon-card o .dark-bg-card */
        opacity: 0.7;
    }

    .pokemon-card h3 {
      font-size: 1.3rem;
      text-transform: capitalize;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .pokemon-card .types {
      font-size: 0.9rem;
      margin-bottom: 12px;
      font-style: italic;
      font-weight: 500;
    }

    .pokemon-card .stats {
      font-size: 0.85rem;
      text-align: left;
      padding: 0 10px;
    }

    .pokemon-card .stats p {
      margin: 4px 0;
      display: flex;
      justify-content: space-between;
    }
    .pokemon-card .stats p span:first-child {
        font-weight: 500;
    }
    
    .loading-message, .error-message {
        grid-column: 1 / -1;
        text-align: center;
        font-size: 1.2rem;
        padding: 20px;
        color: var(--matcha-accent);
        background-color: rgba(255,255,255,0.3);
        border-radius: 10px;
    }
    .error-message {
        color: var(--pokeball-red);
        background-color: rgba(255, 92, 92, 0.2);
    }


    @media (max-width: 768px) {
      h1 {
        font-size: 2.2rem;
      }
      #navigation-controls {
        flex-direction: column;
      }
      .gen-btn, #refresh-btn {
        width: 100%;
        max-width: 300px; /* Para que no sean excesivamente anchos */
        justify-content: center;
      }
       #pokemon-list {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 2rem;
      }
      #search-input {
        width: calc(100% - 100px); /* Ajuste para que quepa mejor con el botón */
      }
      #search-btn {
        width: 90px;
      }
      .pokemon-card img, .pokemon-card .no-sprite {
        width: 80px;
        height: 80px;
      }
      .pokemon-card h3 {
        font-size: 1.15rem;
      }
    }
  </style>
</head>
<body>
  <h1>Pokédex</h1>

  <div id="navigation-controls">
    <button class="gen-btn" data-gen="1">1ª Generación</button>
    <button class="gen-btn" data-gen="2">2ª Generación</button>
    <button class="gen-btn" data-gen="3">3ª Generación</button>
    <button id="refresh-btn" title="Refrescar Pokédex">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
        <circle cx="50" cy="50" r="45" fill="var(--pokeball-red)"/>
        <path d="M 5 50 A 45 45 0 0 1 95 50 H 5 Z" fill="var(--pokeball-white)"/>
        <line x1="5" y1="50" x2="95" y2="50" stroke="var(--pokeball-black)" stroke-width="8"/>
        <circle cx="50" cy="50" r="18" fill="var(--pokeball-white)" stroke="var(--pokeball-black)" stroke-width="8"/>
        <circle cx="50" cy="50" r="10" fill="var(--pokeball-white)" stroke="var(--pokeball-black)" stroke-width="1"/>
      </svg>
      Refrescar
    </button>
  </div>

  <div id="search-container">
    <input type="text" id="search-input" placeholder="Busca un Pokémon...">
    <button id="search-btn">Buscar</button>
  </div>
  <div id="pokemon-list"></div>

  <script>
    const pokemonListDiv = document.getElementById('pokemon-list');
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');
    const genButtons = document.querySelectorAll('.gen-btn');
    const refreshBtn = document.getElementById('refresh-btn');

    const POKEMON_GENERATION_RANGES = {
      1: { offset: 0, limit: 151 },
      2: { offset: 151, limit: 100 },
      3: { offset: 251, limit: 135 }
    };
    const MAX_POKEMON_ID = 386;

    let allFetchedPokemons = [];
    let currentPokemonsToDisplay = [];

    const TYPE_COLORS = { // Hex colors for JS manipulation
        normal: '#A8A77A', fire: '#EE8130', water: '#6390F0',
        electric: '#F7D02C', grass: '#7AC74C', ice: '#96D9D6',
        fighting: '#C22E28', poison: '#A33EA1', ground: '#E2BF65',
        flying: '#A98FF3', psychic: '#F95587', bug: '#A6B91A',
        rock: '#B6A136', ghost: '#735797', dragon: '#6F35FC',
        dark: '#705746', steel: '#B7B7CE', fairy: '#D685AD'
    };
    const DEFAULT_CARD_BG_CSS_VAR = 'var(--matcha-card-bg)';

    // Helper to determine if a hex color is "dark" to adjust text color
    function isColorDark(hexColor) {
        if (!hexColor || !hexColor.startsWith('#')) return false;
        const color = hexColor.substring(1);
        const r = parseInt(color.substring(0, 2), 16);
        const g = parseInt(color.substring(2, 4), 16);
        const b = parseInt(color.substring(4, 6), 16);
        // Standard luminance calculation
        const luminance = (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255;
        return luminance < 0.45; // Threshold for considering a color dark (0 to 1)
    }

    async function fetchAndDisplayPokemons(offset = 0, limit = MAX_POKEMON_ID) {
      try {
        pokemonListDiv.innerHTML = '<p class="loading-message">Cargando Pokémon...</p>';
        
        if (offset === 0 && limit === MAX_POKEMON_ID && allFetchedPokemons.length > 0) {
            currentPokemonsToDisplay = [...allFetchedPokemons];
            renderPokemonList(currentPokemonsToDisplay);
            return;
        }

        const response = await fetch(`https://pokeapi.co/api/v2/pokemon?limit=${limit}&offset=${offset}`);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        
        const pokemonPromises = data.results.map(pokemonRef => fetch(pokemonRef.url).then(res => res.json()));
        const fetchedPokemons = await Promise.all(pokemonPromises);

        currentPokemonsToDisplay = fetchedPokemons.filter(p => p.id <= MAX_POKEMON_ID);

        if (offset === 0 && limit === MAX_POKEMON_ID) {
            allFetchedPokemons = [...currentPokemonsToDisplay];
        }
        
        renderPokemonList(currentPokemonsToDisplay);

      } catch (error) {
        pokemonListDiv.innerHTML = `<p class="error-message">Error al cargar Pokémon: ${error.message}</p>`;
        console.error('Error fetching pokemons:', error);
      }
    }

    function renderPokemonList(pokemonsToRender) {
        pokemonListDiv.innerHTML = '';
        if (pokemonsToRender.length === 0) {
            pokemonListDiv.innerHTML = '<p class="loading-message">No se encontraron Pokémon.</p>';
            return;
        }
        pokemonsToRender.forEach(pokemon => displayPokemon(pokemon));
    }

    function displayPokemon(pokemon) {
      const card = document.createElement('div');
      card.classList.add('pokemon-card');

      const types = pokemon.types.map(typeInfo => typeInfo.type.name);
      let primaryTypeColorHex = null;

      if (types.length > 0) {
        primaryTypeColorHex = TYPE_COLORS[types[0]] || null;
        if (primaryTypeColorHex) {
            if (types.length > 1) {
                const secondaryTypeColorHex = TYPE_COLORS[types[1]] || primaryTypeColorHex;
                card.style.background = `linear-gradient(135deg, ${primaryTypeColorHex}, ${secondaryTypeColorHex})`;
            } else {
                card.style.background = primaryTypeColorHex;
            }
            if (isColorDark(primaryTypeColorHex)) { // Base contrast on primary type for simplicity with gradients
                card.classList.add('dark-bg-card');
            }
        } else {
             card.style.background = DEFAULT_CARD_BG_CSS_VAR; // Fallback to CSS variable
        }
      } else {
        card.style.background = DEFAULT_CARD_BG_CSS_VAR; // Fallback if no types
      }
      
      const spriteUrl = pokemon.sprites.front_default;
      const imgHtml = spriteUrl 
        ? `<img src="${spriteUrl}" alt="${pokemon.name}">`
        : `<div class="no-sprite" style="color: inherit;">${pokemon.name.substring(0,3)}...</div>`;


      card.innerHTML = `
        ${imgHtml}
        <h3>${pokemon.name} (#${pokemon.id})</h3>
        <div class="types">Tipo: ${types.join(', ')}</div>
        <div class="stats">
          <p><span>HP:</span> <span>${pokemon.stats.find(stat => stat.stat.name === 'hp')?.base_stat || 'N/A'}</span></p>
          <p><span>Ataque:</span> <span>${pokemon.stats.find(stat => stat.stat.name === 'attack')?.base_stat || 'N/A'}</span></p>
          <p><span>Defensa:</span> <span>${pokemon.stats.find(stat => stat.stat.name === 'defense')?.base_stat || 'N/A'}</span></p>
          <p><span>Ataque Esp.:</span> <span>${pokemon.stats.find(stat => stat.stat.name === 'special-attack')?.base_stat || 'N/A'}</span></p>
          <p><span>Defensa Esp.:</span> <span>${pokemon.stats.find(stat => stat.stat.name === 'special-defense')?.base_stat || 'N/A'}</span></p>
          <p><span>Velocidad:</span> <span>${pokemon.stats.find(stat => stat.stat.name === 'speed')?.base_stat || 'N/A'}</span></p>
        </div>
      `;
      pokemonListDiv.appendChild(card);
    }

    async function searchPokemon() {
      const query = searchInput.value.toLowerCase().trim();
      if (!query) {
        if (allFetchedPokemons.length > 0) {
            currentPokemonsToDisplay = [...allFetchedPokemons];
            renderPokemonList(currentPokemonsToDisplay);
        } else {
            fetchAndDisplayPokemons(0, MAX_POKEMON_ID);
        }
        return;
      }
      try {
        pokemonListDiv.innerHTML = '<p class="loading-message">Buscando...</p>';
        const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${query}`);
        if (!response.ok) throw new Error('Pokémon no encontrado');
        const pokemon = await response.json();
        
        if (pokemon.id > MAX_POKEMON_ID) {
          pokemonListDiv.innerHTML = `<p class="error-message">Solo se muestran Pokémon hasta la 3ª generación (ID ${MAX_POKEMON_ID}).</p>`;
          return;
        }
        currentPokemonsToDisplay = [pokemon];
        renderPokemonList(currentPokemonsToDisplay);
      } catch (error) {
        pokemonListDiv.innerHTML = '<p class="error-message">Pokémon no encontrado o fuera de rango (1-386).</p>';
        console.error('Error searching pokemon:', error);
      }
    }

    genButtons.forEach(button => {
      button.addEventListener('click', () => {
        const gen = button.dataset.gen;
        if (POKEMON_GENERATION_RANGES[gen]) {
          const { offset, limit } = POKEMON_GENERATION_RANGES[gen];
          fetchAndDisplayPokemons(offset, limit);
        }
      });
    });

    refreshBtn.addEventListener('click', () => {
      searchInput.value = '';
      fetchAndDisplayPokemons(0, MAX_POKEMON_ID);
    });
    
    searchBtn.addEventListener('click', searchPokemon);
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') searchPokemon();
    });

    fetchAndDisplayPokemons(0, MAX_POKEMON_ID);
  </script>
</body>
</html>
